# üì± –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ù–ê–°–¢–†–û–ô–ö–ï –ë–ï–°–®–û–í–ù–´–• –û–ë–ù–û–í–õ–ï–ù–ò–ô

## ‚úÖ –ß–¢–û –£–ñ–ï –†–ï–ê–õ–ò–ó–û–í–ê–ù–û

1. **Google Play In-App Updates API** - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –¥–ª—è –±–µ—Å—à–æ–≤–Ω—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
2. **Remote Config** - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –±–µ–∑ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –∫–æ–¥–∞
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–π —á–µ—Ä–µ–∑ API** - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
4. **–î–≤–∞ —Ä–µ–∂–∏–º–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
   - **Immediate** (–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–µ) - –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
   - **Flexible** (–≥–∏–±–∫–æ–µ) - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤ —Ñ–æ–Ω–µ

## üîß –ß–¢–û –ù–£–ñ–ù–û –°–î–ï–õ–ê–¢–¨ –î–õ–Ø –†–ê–ë–û–¢–´

### 1. –û–ü–£–ë–õ–ò–ö–û–í–ê–¢–¨ –ü–†–ò–õ–û–ñ–ï–ù–ò–ï –í GOOGLE PLAY

**‚ö†Ô∏è –í–ê–ñ–ù–û:** Google Play In-App Updates —Ä–∞–±–æ—Ç–∞–µ—Ç **–¢–û–õ–¨–ö–û** —Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è–º–∏, –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–Ω—ã–º–∏ –≤ Google Play Console (—Ö–æ—Ç—è –±—ã –≤ Internal Testing).

**–®–∞–≥–∏:**
1. –ó–∞–π–¥–∏—Ç–µ –≤ [Google Play Console](https://play.google.com/console)
2. –°–æ–∑–¥–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∏–ª–∏ –≤—ã–±–µ—Ä–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–µ
3. –ó–∞–≥—Ä—É–∑–∏—Ç–µ APK/AAB –≤ —Ä–∞–∑–¥–µ–ª **Internal Testing** (–º–∏–Ω–∏–º—É–º)
4. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ —Ä–µ–ª–∏–∑ (–¥–∞–∂–µ –≤ —Ç–µ—Å—Ç–æ–≤–æ–º —Ç—Ä–µ–∫–µ)

**–ë–µ–∑ —ç—Ç–æ–≥–æ In-App Updates –Ω–µ –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å!** –°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ –æ–±—ã—á–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –¥–∏–∞–ª–æ–≥.

### 2. –û–ë–ù–û–í–ò–¢–¨ –í–ï–†–°–ò–Æ –í version-config.json

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/version-config.json` –∏ –æ–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é:

```json
{
  "android_master": {
    "current_version": "1.2.2",  // ‚Üê –û–±–Ω–æ–≤–∏—Ç–µ –Ω–∞ –∞–∫—Ç—É–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é
    "min_required_version": "1.0.0",
    "force_update": false,
    "release_notes": "–û–ø–∏—Å–∞–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è",
    "download_url": "http://212.74.227.208:3000/updates",
    "supported_os_versions": ["8.0", "9.0", "10", "11", "12", "13"]
  }
}
```

**–í–∞–∂–Ω–æ:** `current_version` –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å **–≤—ã—à–µ** —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –≤ `app/build.gradle.kts` (—Å–µ–π—á–∞—Å `versionName = "1.2.2"`).

### 3. –û–ë–ù–û–í–ò–¢–¨ VERSION_CODE –í build.gradle.kts

–ü—Ä–∏ –∫–∞–∂–¥–æ–º –Ω–æ–≤–æ–º —Ä–µ–ª–∏–∑–µ —É–≤–µ–ª–∏—á–∏–≤–∞–π—Ç–µ `versionCode`:

```kotlin
defaultConfig {
    versionCode = 15  // ‚Üê –£–≤–µ–ª–∏—á—å—Ç–µ –Ω–∞ 1
    versionName = "1.2.3"  // ‚Üê –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ—Ä—Å–∏—é
}
```

### 4. –ù–ê–°–¢–†–û–ò–¢–¨ REMOTE CONFIG (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–û—Ç–∫—Ä–æ–π—Ç–µ `backend/remote-config.json` –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ:

```json
{
  "maintenance_mode": false,
  "min_app_version": "1.0.0",
  "feature_flags": {
    "enable_mlm": true,
    "enable_chat": true
  },
  "app_config": {
    "max_orders_per_day": 10,
    "support_phone": "+79991234567"
  }
}
```

### 5. –ü–†–û–í–ï–†–ò–¢–¨ –ó–ê–í–ò–°–ò–ú–û–°–¢–ò

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ `app/build.gradle.kts` –µ—Å—Ç—å:

```kotlin
// Google Play In-App Updates
implementation("com.google.android.play:app-update:2.1.0")
implementation("com.google.android.play:app-update-ktx:2.1.0")
```

## üß™ –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–ï

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ In-App Updates

1. **–û–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Internal Testing** –≤ Google Play Console
2. **–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** –∏–∑ Google Play (Internal Testing)
3. **–£–≤–µ–ª–∏—á—å—Ç–µ –≤–µ—Ä—Å–∏—é** –≤ `version-config.json` –∏ `build.gradle.kts`
4. **–û–ø—É–±–ª–∏–∫—É–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é** –≤ Google Play Console
5. **–ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ** - –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

### –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑ Google Play

–ï—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–µ –æ–ø—É–±–ª–∏–∫–æ–≤–∞–Ω–æ –≤ Google Play, —Å–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **fallback**:
- –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- –û—Ç–∫—Ä—ã–≤–∞–µ—Ç Google Play –∏–ª–∏ `download_url` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞

## üìã –õ–û–ì–ò–ö–ê –†–ê–ë–û–¢–´

1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –≤–µ—Ä—Å–∏—è —á–µ—Ä–µ–∑ `/api/version/check`
   - –ï—Å–ª–∏ `updateRequired = true`:
     - –ü—ã—Ç–∞–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **In-App Updates** (–µ—Å–ª–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Google Play)
     - –ï—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç ‚Üí –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–∏–∞–ª–æ–≥ —Å –∫–Ω–æ–ø–∫–æ–π "–û–±–Ω–æ–≤–∏—Ç—å"

2. **–†–µ–∂–∏–º—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:**
   - `forceUpdate = true` ‚Üí **Immediate** (–±–ª–æ–∫–∏—Ä—É—é—â–µ–µ)
   - `forceUpdate = false` ‚Üí **Flexible** (–≤ —Ñ–æ–Ω–µ)

3. **–ì–∏–±–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –°–∫–∞—á–∏–≤–∞–µ—Ç—Å—è –≤ —Ñ–æ–Ω–µ
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å
   - –ü–æ—Å–ª–µ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –¥–∏–∞–ª–æ–≥ "–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å"

## üîç –û–¢–õ–ê–î–ö–ê

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# Android Studio Logcat
adb logcat | grep -E "UpdateManager|MainActivity"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ API

```bash
curl -X POST http://212.74.227.208:3000/api/version/check \
  -H "Content-Type: application/json" \
  -d '{"platform":"android_master","app_version":"1.2.2"}'
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Remote Config

```bash
curl http://212.74.227.208:3000/api/remote-config?platform=android_master
```

## ‚ö†Ô∏è –í–ê–ñ–ù–´–ï –ó–ê–ú–ï–ß–ê–ù–ò–Ø

1. **In-App Updates —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å Google Play** - –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω—É–∂–µ–Ω —Ö–æ—Ç—è –±—ã Internal Testing —Ç—Ä–µ–∫
2. **–í–µ—Ä—Å–∏—è –≤ –∫–æ–Ω—Ñ–∏–≥–µ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤—ã—à–µ** —Ç–µ–∫—É—â–µ–π –≤–µ—Ä—Å–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **versionCode –¥–æ–ª–∂–µ–Ω —É–≤–µ–ª–∏—á–∏–≤–∞—Ç—å—Å—è** –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Ä–µ–ª–∏–∑–µ
4. **Fallback —Ä–∞–±–æ—Ç–∞–µ—Ç –≤—Å–µ–≥–¥–∞** - –µ—Å–ª–∏ In-App Updates –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ–±—ã—á–Ω—ã–π –¥–∏–∞–ª–æ–≥

## üöÄ –ë–´–°–¢–†–´–ô –°–¢–ê–†–¢

1. –û–ø—É–±–ª–∏–∫—É–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Google Play Console (Internal Testing)
2. –û–±–Ω–æ–≤–∏—Ç–µ `backend/version-config.json`:
   ```json
   "current_version": "1.2.3"  // –í—ã—à–µ —Ç–µ–∫—É—â–µ–π
   ```
3. –£–≤–µ–ª–∏—á—å—Ç–µ `versionCode` –≤ `app/build.gradle.kts`
4. –°–æ–±–µ—Ä–∏—Ç–µ –∏ –æ–ø—É–±–ª–∏–∫—É–π—Ç–µ –Ω–æ–≤—É—é –≤–µ—Ä—Å–∏—é –≤ Google Play
5. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –ø–æ—è–≤–∏—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏!

## üìû –ü–û–î–î–ï–†–ñ–ö–ê

–ü—Ä–∏ –ø—Ä–æ–±–ª–µ–º–∞—Ö –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
- –õ–æ–≥–∏ –≤ Android Studio Logcat
- –°—Ç–∞—Ç—É—Å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –≤ Google Play Console
- –í–µ—Ä—Å–∏—é –≤ `version-config.json`
- –ù–∞–ª–∏—á–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ `app-update` –≤ `build.gradle.kts`
