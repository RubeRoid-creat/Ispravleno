# WebSocket API Documentation - –ú–∞—Å—Ç–µ—Ä–ü—Ä–æ—Ñ–∏

## üì° –û–±—â–∏–µ —Å–≤–µ–¥–µ–Ω–∏—è

WebSocket —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ç–æ–º –∂–µ –ø–æ—Ä—Ç—É, —á—Ç–æ –∏ HTTP API, –ø–æ –ø—É—Ç–∏ `/ws`.

**URL –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:**
```
ws://212.74.227.208:3000/ws  (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
wss://your-domain.com/ws     (–¥–ª—è production —Å HTTPS)
```

---

## üîê –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ—Å–ª–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å JWT —Ç–æ–∫–µ–Ω:

```json
{
  "type": "auth",
  "token": "your-jwt-token-here"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ —É—Å–ø–µ—Ö–µ:**
```json
{
  "type": "auth_success",
  "message": "–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —É—Å–ø–µ—à–Ω–∞"
}
```

**–û—Ç–≤–µ—Ç –ø—Ä–∏ –æ—à–∏–±–∫–µ:**
```json
{
  "type": "auth_error",
  "message": "–ù–µ–≤–µ—Ä–Ω—ã–π —Ç–æ–∫–µ–Ω"
}
```

---

## üîî –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–∞—è–≤–∫–∏ (–¥–ª—è –º–∞—Å—Ç–µ—Ä–æ–≤)

### –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏–µ –∑–∞—è–≤–æ–∫

**–û—Ç–ø—Ä–∞–≤–∏—Ç—å:**
```json
{
  "type": "subscribe_assignments"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "subscribed_assignments",
  "message": "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–∞—è–≤–∫–∏ –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞"
}
```

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å —Ä–æ–ª—å "–º–∞—Å—Ç–µ—Ä"

### –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∑–∞—è–≤–æ–∫

**–û—Ç–ø—Ä–∞–≤–∏—Ç—å:**
```json
{
  "type": "unsubscribe_assignments"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "unsubscribed_assignments",
  "message": "–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ –∑–∞—è–≤–∫–∏ –æ—Ç–º–µ–Ω–µ–Ω–∞"
}
```

---

## üìã –ü–æ–ª—É—á–µ–Ω–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π –æ –∑–∞—è–≤–∫–∞—Ö

### –ù–æ–≤–æ–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ

–ö–æ–≥–¥–∞ –º–∞—Å—Ç–µ—Ä—É –Ω–∞–∑–Ω–∞—á–∞–µ—Ç—Å—è –Ω–æ–≤–∞—è –∑–∞—è–≤–∫–∞, –æ–Ω –ø–æ–ª—É—á–∞–µ—Ç:

```json
{
  "type": "new_assignment",
  "assignment": {
    "id": 123,
    "order_id": 456,
    "master_id": 789,
    "status": "pending",
    "created_at": "2025-12-23T10:30:00.000Z",
    "expires_at": "2025-12-23T10:35:00.000Z",
    "attempt_number": 1,
    
    // –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è (–¥–æ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞—è–≤–∫–∏):
    "device_type": "—Ö–æ–ª–æ–¥–∏–ª—å–Ω–∏–∫",
    "address": "—É–ª. –õ–µ–Ω–∏–Ω–∞, –¥. 10",
    "problem_description": "–ù–µ –º–æ—Ä–æ–∑–∏—Ç",
    "latitude": 55.751244,
    "longitude": 37.618423
    
    // –ù–ï –≤–∫–ª—é—á–∞–µ—Ç—Å—è –¥–æ –ø—Ä–∏–Ω—è—Ç–∏—è:
    // - device_brand, device_model
    // - client_name, client_phone
    // - estimated_cost
    // - arrival_time
  }
}
```

**–í–∞–∂–Ω–æ:** –î–æ –ø—Ä–∏–Ω—è—Ç–∏—è –∑–∞—è–≤–∫–∏ –º–∞—Å—Ç–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ:
- –ê–¥—Ä–µ—Å
- –¢–∏–ø —Ç–µ—Ö–Ω–∏–∫–∏
- –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã
- –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã (–¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏—è)

–ü–æ—Å–ª–µ –ø—Ä–∏–Ω—è—Ç–∏—è —á–µ—Ä–µ–∑ REST API `/api/assignments/:id/accept` –º–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∏—Ç –ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ.

### –ò—Å—Ç–µ—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è

–ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –Ω–µ –ø—Ä–∏–Ω—è–ª –∑–∞—è–≤–∫—É –≤–æ–≤—Ä–µ–º—è:

```json
{
  "type": "assignment_expired",
  "assignmentId": 123
}
```

---

## üì® –û–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

### –ò–∑–º–µ–Ω–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ –∑–∞–∫–∞–∑–∞

–ö–ª–∏–µ–Ω—Ç –∏ –º–∞—Å—Ç–µ—Ä –ø–æ–ª—É—á–∞—é—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç–∞—Ç—É—Å–∞:

```json
{
  "type": "order_status_update",
  "orderId": 456,
  "newStatus": "in_progress",
  "timestamp": "2025-12-23T10:35:00.000Z"
}
```

**–í–æ–∑–º–æ–∂–Ω—ã–µ —Å—Ç–∞—Ç—É—Å—ã:**
- `new` - –Ω–æ–≤—ã–π –∑–∞–∫–∞–∑
- `assigned` - –Ω–∞–∑–Ω–∞—á–µ–Ω –º–∞—Å—Ç–µ—Ä
- `in_progress` - –≤ —Ä–∞–±–æ—Ç–µ
- `diagnostics` - –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞
- `waiting_parts` - –æ–∂–∏–¥–∞–Ω–∏–µ –∑–∞–ø—á–∞—Å—Ç–µ–π
- `completed` - –∑–∞–≤–µ—Ä—à–µ–Ω
- `cancelled` - –æ—Ç–º–µ–Ω–µ–Ω

---

## üí¨ –ß–∞—Ç –∑–∞–∫–∞–∑–∞ (–¥–ª—è –±—É–¥—É—â–µ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏)

### –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ —á–∞—Ç—É –∑–∞–∫–∞–∑–∞

```json
{
  "type": "join_order_chat",
  "orderId": 456
}
```

### –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ

```json
{
  "type": "chat_message",
  "orderId": 456,
  "message": "–Ø –µ–¥—É –∫ –≤–∞–º",
  "messageType": "text"
}
```

### –í—ã–π—Ç–∏ –∏–∑ —á–∞—Ç–∞

```json
{
  "type": "leave_order_chat",
  "orderId": 456
}
```

---

## ‚ù§Ô∏è –ü–æ–¥–¥–µ—Ä–∂–∞–Ω–∏–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è (Ping-Pong)

–î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å `ping` –∫–∞–∂–¥—ã–µ 30-60 —Å–µ–∫—É–Ω–¥:

**–û—Ç–ø—Ä–∞–≤–∏—Ç—å:**
```json
{
  "type": "ping"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "type": "pong"
}
```

**–í–∞–∂–Ω–æ:**
- –ï—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –Ω–µ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `ping` –±–æ–ª–µ–µ 5 –º–∏–Ω—É—Ç, –µ–≥–æ –ø–æ–¥–ø–∏—Å–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç—Å—è
- –ü—Ä–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –Ω—É–∂–Ω–æ —Å–Ω–æ–≤–∞ –ø—Ä–æ–π—Ç–∏ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é –∏ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫–∏

---

## ‚ö†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

–í—Å–µ –æ—à–∏–±–∫–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "type": "error",
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

**–¢–∏–ø–∏—á–Ω—ã–µ –æ—à–∏–±–∫–∏:**
- `"–¢—Ä–µ–±—É–µ—Ç—Å—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è"` - –Ω–µ –ø—Ä–æ—à–ª–∏ auth
- `"–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Ç–µ—Ä–æ–º"` - –ø–æ–ø—ã—Ç–∫–∞ –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫–∏ –Ω–µ-–º–∞—Å—Ç–µ—Ä–æ–º
- `"–ó–∞–∫–∞–∑ –Ω–µ –Ω–∞–π–¥–µ–Ω"` - –ø–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –∑–∞–∫–∞–∑—É
- `"–ù–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ —ç—Ç–æ–º—É –∑–∞–∫–∞–∑—É"` - –ø–æ–ø—ã—Ç–∫–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —á—É–∂–æ–º—É –∑–∞–∫–∞–∑—É

---

## üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π flow –¥–ª—è Android –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### 1. –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è (–µ—Å–ª–∏ –º–∞—Å—Ç–µ—Ä –Ω–∞ —Å–º–µ–Ω–µ)

```kotlin
// 1. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ WebSocket
val webSocket = connectWebSocket("ws://212.74.227.208:3000/ws")

// 2. –û—Ç–ø—Ä–∞–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
webSocket.send(json {
    "type" to "auth"
    "token" to savedToken
})

// 3. –î–æ–∂–¥–∞—Ç—å—Å—è auth_success

// 4. –ü–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫–∏
webSocket.send(json {
    "type" to "subscribe_assignments"
})

// 5. –ó–∞–ø—É—Å—Ç–∏—Ç—å ping –∫–∞–∂–¥—ã–µ 45 —Å–µ–∫—É–Ω–¥
startPingTimer(45_000)
```

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–æ–±—â–µ–Ω–∏–π

```kotlin
webSocket.onMessage { message ->
    when (message.type) {
        "new_assignment" -> {
            // –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –º–∞—Å—Ç–µ—Ä—É
            // –î–æ–±–∞–≤–∏—Ç—å –≤ —Å–ø–∏—Å–æ–∫ –Ω–æ–≤—ã—Ö –∑–∞—è–≤–æ–∫
            showAssignmentNotification(message.assignment)
        }
        
        "assignment_expired" -> {
            // –£–¥–∞–ª–∏—Ç—å –∑–∞—è–≤–∫—É –∏–∑ —Å–ø–∏—Å–∫–∞
            removeAssignment(message.assignmentId)
        }
        
        "order_status_update" -> {
            // –û–±–Ω–æ–≤–∏—Ç—å —Å—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ –≤ UI
            updateOrderStatus(message.orderId, message.newStatus)
        }
        
        "pong" -> {
            // –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∂–∏–≤–æ
        }
    }
}
```

### 3. –û—Ç–ø—Ä–∞–≤–∫–∞ ping

```kotlin
val pingTimer = Timer()
pingTimer.scheduleAtFixedRate(0, 45_000) {
    if (webSocket.isConnected) {
        webSocket.send(json {
            "type" to "ping"
        })
    }
}
```

### 4. –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –æ–±—Ä—ã–≤–µ —Å–≤—è–∑–∏

```kotlin
webSocket.onClose { code, reason ->
    Log.w("WebSocket", "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∑–∞–∫—Ä—ã—Ç–æ: $code - $reason")
    
    // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
    Handler().postDelayed({
        reconnectWebSocket()
    }, 5000)
}

webSocket.onError { error ->
    Log.e("WebSocket", "–û—à–∏–±–∫–∞ WebSocket: $error")
}
```

### 5. –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ —Å–º–µ–Ω—ã

```kotlin
fun endShift() {
    // 1. –û—Ç–ø–∏—Å–∞—Ç—å—Å—è –æ—Ç –∑–∞—è–≤–æ–∫
    webSocket.send(json {
        "type" to "unsubscribe_assignments"
    })
    
    // 2. –ó–∞–∫—Ä—ã—Ç—å —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
    webSocket.close()
    
    // 3. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å ping —Ç–∞–π–º–µ—Ä
    pingTimer.cancel()
}
```

---

## üìä –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ WebSocket –Ω–∞–¥ Polling

| –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞ | Polling (REST API –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫) | WebSocket (Real-time) |
|---------------|----------------------------------|----------------------|
| **–ó–∞–¥–µ—Ä–∂–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π** | –î–æ 30 —Å–µ–∫—É–Ω–¥ | < 1 —Å–µ–∫—É–Ω–¥—ã |
| **–ù–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä** | –í—ã—Å–æ–∫–∞—è (–∑–∞–ø—Ä–æ—Å—ã –∫–∞–∂–¥—ã–µ 30 —Å–µ–∫) | –ù–∏–∑–∫–∞—è (—Ç–æ–ª—å–∫–æ —Å–æ–±—ã—Ç–∏—è) |
| **–†–∞—Å—Ö–æ–¥ –±–∞—Ç–∞—Ä–µ–∏** | –í—ã—Å–æ–∫–∏–π (–ø–æ—Å—Ç–æ—è–Ω–Ω—ã–µ HTTP –∑–∞–ø—Ä–æ—Å—ã) | –ù–∏–∑–∫–∏–π (–æ–¥–Ω–æ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ) |
| **–¢—Ä–∞—Ñ–∏–∫ –¥–∞–Ω–Ω—ã—Ö** | –í—ã—Å–æ–∫–∏–π (–ø–æ–≤—Ç–æ—Ä–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö) | –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π (—Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è) |
| **–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å** | –°—Ä–µ–¥–Ω—è—è (–º–æ–≥—É—Ç –±—ã—Ç—å –ø—Ä–æ–ø—É—Å–∫–∏) | –í—ã—Å–æ–∫–∞—è (–≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –¥–æ—Å—Ç–∞–≤–∫–∞) |

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ WebSocket

### –° –ø–æ–º–æ—â—å—é wscat (npm)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞
npm install -g wscat

# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
wscat -c ws://212.74.227.208:3000/ws

# –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
> {"type":"auth","token":"your-token-here"}

# –ü–æ–¥–ø–∏—Å–∫–∞
> {"type":"subscribe_assignments"}

# Ping
> {"type":"ping"}
```

### –° –ø–æ–º–æ—â—å—é Postman

1. –°–æ–∑–¥–∞—Ç—å –Ω–æ–≤—ã–π WebSocket Request
2. URL: `ws://212.74.227.208:3000/ws`
3. Connect
4. –û—Ç–ø—Ä–∞–≤–∏—Ç—å JSON —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –≤—ã—à–µ

---

## üìà –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

–ê–¥–º–∏–Ω-—ç–Ω–¥–ø–æ–∏–Ω—Ç –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –ø–æ–¥–ø–∏—Å–æ–∫:

```bash
GET /api/admin/websocket/stats
Authorization: Bearer <admin-token>
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "totalConnected": 15,
  "totalSubscribed": 12,
  "activeSubscriptions": 10,
  "onShiftSubscriptions": 8,
  "subscriptions": [
    {
      "userId": 5,
      "masterId": 3,
      "subscribed": true,
      "onShift": true,
      "lastPing": "2025-12-23T10:45:00.000Z",
      "isActive": true
    }
  ]
}
```

---

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **JWT —Ç–æ–∫–µ–Ω** - –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–µ—Ä–µ–¥ –ª—é–±—ã–º–∏ –¥–µ–π—Å—Ç–≤–∏—è–º–∏
2. **–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–æ–ª–∏** - —Ç–æ–ª—å–∫–æ –º–∞—Å—Ç–µ—Ä–∞ –º–æ–≥—É—Ç –ø–æ–¥–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ –∑–∞—è–≤–∫–∏
3. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–∞** - –º–∞—Å—Ç–µ—Ä –≤–∏–¥–∏—Ç —Ç–æ–ª—å–∫–æ —Å–≤–æ–∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è
4. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞** - –Ω–µ–∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ 5 –º–∏–Ω—É—Ç
5. **Rate limiting** - –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º WebSocket —Å–æ–æ–±—â–µ–Ω–∏—è–º

---

## üÜò Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: WebSocket –Ω–µ –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL (ws:// –¥–ª—è HTTP, wss:// –¥–ª—è HTTPS)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ firewall –∏ –ø–æ—Ä—Ç—ã

### –ü—Ä–æ–±–ª–µ–º–∞: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç

**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å JWT —Ç–æ–∫–µ–Ω–∞
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Ç–æ–∫–µ–Ω –Ω–µ –∏—Å—Ç–µ–∫
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–æ—Ä–º–∞—Ç —Å–æ–æ–±—â–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: –ù–µ –ø—Ä–∏—Ö–æ–¥—è—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –∑–∞—è–≤–∫–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
1. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –æ—Ç–ø—Ä–∞–≤–∏–ª–∏ `subscribe_assignments`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –º–∞—Å—Ç–µ—Ä –Ω–∞ —Å–º–µ–Ω–µ (`is_on_shift = 1`)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é –º–∞—Å—Ç–µ—Ä–∞ (–¥–æ–ª–∂–Ω–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å —Ç–∏–ø—É —Ç–µ—Ö–Ω–∏–∫–∏)
4. –û—Ç–ø—Ä–∞–≤–ª—è–π—Ç–µ `ping` —Ä–µ–≥—É–ª—è—Ä–Ω–æ (–∏–Ω–∞—á–µ –ø–æ–¥–ø–∏—Å–∫–∞ —É–¥–∞–ª–∏—Ç—Å—è)

### –ü—Ä–æ–±–ª–µ–º–∞: –°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —á–∞—Å—Ç–æ –æ–±—Ä—ã–≤–∞–µ—Ç—Å—è

**–†–µ—à–µ–Ω–∏–µ:**
1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ
2. –£–≤–µ–ª–∏—á—å—Ç–µ —á–∞—Å—Ç–æ—Ç—É ping (–¥–æ –∫–∞–∂–¥—ã—Ö 30 —Å–µ–∫—É–Ω–¥)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
4. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ keepalive –Ω–∞ —É—Ä–æ–≤–Ω–µ TCP

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [WebSocket RFC 6455](https://tools.ietf.org/html/rfc6455)
- [OkHttp WebSocket Documentation](https://square.github.io/okhttp/4.x/okhttp/okhttp3/-web-socket/)
- [Backend Source Code](./websocket.js)
- [Assignment Service Source](./services/assignment-service.js)

---

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 23.12.2025  
**–í–µ—Ä—Å–∏—è API:** 1.0.0
