#!/bin/bash
# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –±—ç–∫–µ–Ω–¥–∞

echo "üöÄ –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏..."

# –ü–µ—Ä–µ—Ö–æ–¥–∏–º –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
cd "$(dirname "$0")"

# –°–æ–∑–¥–∞–µ–º .env.production —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º API URL
if [ ! -f ".env.production" ]; then
    echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ .env.production..."
    echo "VITE_API_URL=http://212.74.227.208:3000/api" > .env.production
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —Å–æ–±—Ä–∞–Ω –ª–∏ –ø—Ä–æ–µ–∫—Ç
if [ ! -d "dist" ]; then
    echo "üì¶ –°–±–æ—Ä–∫–∞ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏..."
    npm install
    npm run build
fi

# –ó–∞–ø—É—Å–∫–∞–µ–º —á–µ—Ä–µ–∑ PM2
echo "‚ñ∂Ô∏è  –ó–∞–ø—É—Å–∫ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –Ω–∞ –ø–æ—Ä—Ç—É 3001..."
pm2 start npm --name "admin-panel" -- run serve

# –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é PM2
pm2 save

echo "‚úÖ –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å –∑–∞–ø—É—â–µ–Ω–∞!"
echo "üåê –î–æ—Å—Ç—É–ø–Ω–∞ –ø–æ –∞–¥—Ä–µ—Å—É: http://0.0.0.0:3001/admin"
echo ""
echo "üìä –°—Ç–∞—Ç—É—Å –ø—Ä–æ—Ü–µ—Å—Å–æ–≤:"
pm2 list
